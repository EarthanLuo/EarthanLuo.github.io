---
title: 马尔科夫链
date: 2025-11-16 10:00:00 +0800
categories: [数学原理, 随机过程]
tags: [马尔科夫链, 离散参数马氏链, 马氏性, 分类]
math: true
---

## 4.1 定义与分类

### 4.1.1 离散参数马氏链定义

随机过程 $\\{X_n, n \geq 0\\}$，状态空间 $S=\\{1,2,3,……\\}$

### 4.1.2 马氏性

$$
P(X_{n+1}=i_{n+1}|X_0=i_0,\ldots,X_n=i_n)=P(X_{n+1}=i_{n+1}|X_n=i_n)
$$

> [!NOTE]
>
> 未来的状态只与现在的关系有关，与过去无关，即无记忆性。

### 4.1.3 分类

![image-20251106122424503](/assets/illustrations/image-20251106122424503.png)

## 4.2 转移概率及矩阵

### 4.2.1 一步转移概率

定义：

$$
p_{ij}^{(1)}(m)=P(X_{m+1}=j|X_m=i)\quad (i,j \in S)
$$

称为在$m$时刻的**一步转移概率**，它是马氏链$\{X_n\}$在已知第$m$步处于状态$i$，经过一步后马氏链处于状态$j$的条件概率。

### 4.2.2 k 步转移概率

定义

$$
p_{ij}^{(k)}(m)=P(X_{m+k}=j|X_m=i)\quad (k \geq 1)
$$

称为在$m$时刻的**k 步转移概率**，它是马氏链$\{X_n\}$在已知第$m$步处于状态$i$，经过 k 步后马氏链处于状态$j$的条件概率。

### 4.2.3 齐次马氏链

马氏链当 k 步转移概率的结果$p_{ij}^{(k)}(m)$不随$m$的改变而变化时，称这种马氏链为齐次马氏链，记作$p_{ij}^{(k)}$

举个例子：

- 若在第 2 步处于状态 i，经 3 步转移到 j 的概率，和在第 10 步处于状态 i，经 3 步转移到 j 的概率完全相同。
- 这种 "不管什么时候开始转移，只要状态和步数相同，概率就相同" 的特性，就是 "齐次" 的核心。

> [!NOTE]
>
> 这种形态在时间轴上的表现为：在时间轴上状态的变化幅度是均匀的，不管起始处于什么时刻，只要初始状态相同，那么经过 k 步都会到达同样的状态。

很显然，齐次马氏链的转移概率有如下性质：

- 概率为非负数：$p_{ij}^{(k)} \geq 0 \quad i,j \in S$
- 在某时刻的状态为$i$，遍历状态空间中 k 步能达到的所有状态，这些齐次马氏链的概率之和应该为 1：$\sum_{j \in S} p_{ij}^{(k)} =1 \quad i\in S$

当 k=1 时，$p_{ij}^{(1)}$称为一步转移概率，记为$p_{ij}:=p_{ij}^{(1)}$

### 4.2.4 正则性条件

为了运算方便，通常还规定：

$$
p_{ij}^{(0)}=\delta_{ij}=\begin{cases} 1, & i=j \\ 0, & i \neq j \end{cases}
$$

> [!NOTE]
>
> $p_{ij}^{(0)}$描述为，在齐次马氏链的条件下，某时刻为状态为$i$，经过 0 步，状态为$j$的概率。因为经过 0 步，很显然，只可能还是原来的状态，即$j=i$，是一个必然事件。

### 4.2.5 转移矩阵

一步转移矩阵

$$
P=(p_{ij})
$$

其中$i$和$j$对应行和列，行代表某时刻的当前状态$i$，列代表经过一步到达的状态$j$。

k 步转移矩阵

$$
P^{(k)}=(p_{ij}^{(k)})=P^k
$$

同理，其中$i$和$j$对应行和列，行代表某时刻的当前状态$i$，列代表经过 k 步到达的状态$j$。

### 4.2.6 状态转移图

举例：

![img](/assets/illustrations/2222564-20220103213204390-45349020.png)

## 4.3 Chapman-Kolmogorov（C-K）方程

### 4.3.1 定理内容

> [!CAUTION]
>
> 注意，本章考虑的皆是齐次马氏链。这意味着转移概率不随时间变化，即$p_{ij}^{(k)}(m) = p_{ij}^{(k)}$对所有$m$都成立。

公式（1）：

$$
p_{ij}^{(n)}=\sum_{k \in S} p_{ik}^{(l)} p_{kj}^{(n-l)}
$$

解释：

- $p_{ij}^{(n)}$：当前状态是$i$，经过$n$步，到达状态$j$的概率。
- $p_{ik}^{(l)}$：当前状态是$i$，经过$l$步，到达状态$k$的概率。
- $p_{kj}^{(n-l)}$：当前状态是$k$，经过$n-l$步，到达状态$j$的概率。

**按古典概率进行理解，可看作状态$i$到达状态$j$有许多的路径，这些路径皆以状态$k$作为跳板，那么每条路径都可以分解为两段概率的相乘，所有路径加起来，就是总概率了。**

矩阵形式（2）：

$$
P^{(n)}=P^{(l)}P^{(n-l)}
$$

解释：

- $P^{(n)}: R^{i \times j}$
- $P^{(l)}: R^{i \times k}$
- $P^{(n-l)}: R^{k \times j}$

从矩阵的角度来说一个$n$步转移矩阵，可以分解为多个转移矩阵，符合矩阵的线性性质。

如果一个多步转移矩阵，可以知道其一步转移矩阵，那么就可以将一个多步矩阵转换为多个一步转移矩阵的乘积，如

$$
P^{(n)}=P^{(1)}P^{(n-1)}=P^{(1)}P^{(1)}P^{(n-2)}=……=(P^{(1)})^n
$$

如此，那么$n$ 步转移矩阵由一步转移矩阵完全确定。

### 4.3.2 证明核心

通过中间状态 $k$ 拆分概率，利用马氏性

$$
\begin{align}
p_{ij}^{(n)}&=P(X_{m+n}=j|X_m=i) \\
&=frac{P(X_{m+n}=j,X_m=i)}{P(X_m=i)} \\
\end{align}
$$

因为马氏链的性质：未来的状态只与当前的状态的有关，所以

$$
\begin{align}
P(X_{m+n}=j,X_m=i) &= P(X_{m+n}=j,\bigcup _{k \in S}X_{m+l}=k,X_m=i) \\
&=\bigcup _{k \in S} P(X_{m+n}=j,X_{m+l}=k,X_m=i)  \\
\end{align}
$$

那么

$$
\begin{align}
\frac{P(X_{m+n}=j,X_m=i)}{P(X_m=i)} &= \frac{\bigcup _{k \in S} P(X_{m+n}=j,X_{m+l}=k,X_m=i) }{P(X_m=i)} \\
&= \sum_{k \in S} \frac{P(X_{m+n}=j,X_{m+l}=k,X_m=i) }{P(X_m=i)} \\
&= \sum_{k \in S} \frac{P(X_{m+n}=j,X_{m+l}=k,X_m=i) }{P(X_{m+l}=k,X_m=i)} \cdot \frac{P(X_{m+l}=k,X_m=i) }{P(X_m=i)} \\
&= \sum_{k \in S} P(X_{m+n}=j|X_{m+l}=k,X_m=i) \cdot P(X_{m+l}=k|X_m=i) \\
&= \sum_{k \in S} P(X_{m+n}=j|X_{m+l}=k) \cdot P(X_{m+l}=k|X_m=i) \\
&= \sum_{k \in S} p^{(n-l)}_{kj} \cdot p^{(l)}_{ik}
\end{align}
$$

## 4.4 概率分布

### 4.4.1 绝对概率分布

定义：

$$
p_j(n)=P(X_n=j)\quad (j \in S, n \geq 1)
$$

解释：

- $p_j(n)$：当前时刻为$n$，此时的状态为$j$
- $X_n$：$n$时刻的状态

> [!CAUTION]
>
> 与转移概率$p_{ij}^{(n)}$的不同之处：
>
> - 转移概率：描述的是从某一状态出发，经过$n$步转移到另一状态的条件概率
> - 绝对概率：描述的是在某一时刻系统处于某个状态的无条件概率

多维形式表示：

$$P(n)=(p_0(n),p_1(n),\ldots)^T$$

> [!CAUTION]
>
> 与转移矩阵的形式不同：
>
> 转移矩阵的写法为$P^{(n)}$，代表的是$n$步。
>
> 绝对概率$P(n)$代表的是$n$时刻。

### 4.4.2 初始概率分布

定义：

$$
p_j=p_j(0)=P(X_0=j)\quad (j \in S)
$$

多维形式表示：

$$P(0)=(p_0,p_1,\ldots)^T$$

### 4.4.3 绝对概率、初始概率和转移概率的关系

#### 一维概率分布

$$
P(X_n=j)=p_j(n)=\sum_{i \in S} p_i(0)p_{ij}^{(n)}
$$

解释：

- $p_j(n)$：绝对概率，时刻为$n$，这个时刻的状态为$j$
- $p_i(0)$：初始概率，时刻为 0，0 时刻的状态为$i$
- $p_{ij}^{(n)}$：转移概率，从状态$i$转移到状态$j$，经过步数为$n$步

证明：

$$
\begin{align}
p_j(n) &= P(X_n=j) \\
&(全概率公式，将P(X_0)进行分割) \\
&= \sum_{i \in S} P(X_n=j,X_0=i) \\
&(条件概率的乘法公式) \\
&=\sum_{i \in S} P(X_n=j|X_0=i)P(X_0=i) \\
&(转移概率、初始概率) \\
&=\sum_{i \in S} p_{ij}^{(n)}p_i(0)
\end{align}
$$

#### 联合概率分布

$$
P(X_1=i_1,\ldots,X_n=i_n)=\sum_{i \in S} p_i p_{ii_1} \cdots p_{i_{n-1}i_n}
$$

#### 多维情形

设 $\{X_n, n = 0, 1, \cdots\}$ 为齐次马氏链，则对于 $\forall 0 \leq n_1 < n_2 < \cdots < n_k$ 有

$$
\begin{align*}
P(X_{n_1} &= i_{n_1}, X_{n_2} = i_{n_2}, \cdots, X_{n_k} = i_{n_k}) \\
&(条件概率的乘法公式) \\
&= P(X_{n_1} = i_{n_1}, X_{n_2} = i_{n_2}, \cdots, X_{n_{k-1}} = i_{n_{k-1}})  \cdot P(X_{n_k} = i_{n_k} | X_{n_1} = i_{n_1}, X_{n_2} = i_{n_2}, \cdots, X_{n_{k-1}} = i_{n_{k-1}}) \\
&(马氏性质) \\
&= P(X_{n_1} = i_{n_1}, X_{n_2} = i_{n_2}, \cdots, X_{n_{k-1}} = i_{n_{k-1}}) \cdot P(X_{n_k} = i_{n_k} | X_{n_{k-1}} = i_{n_{k-1}}) \\
&(转移概率的定义公式) \\
&= P(X_{n_1} = i_{n_1}, X_{n_2} = i_{n_2}, \cdots, X_{n_{k-1}} = i_{n_{k-1}}) \cdot p_{i_{n_{k-1}} i_{n_k}}^{(n_k - n_{k-1})} \\
&= \dots \quad (经过迭代)\\
&= p_{i_{n_1}}(n_1) p_{i_{n_1} i_{n_2}}^{(n_2 - n_1)} \cdots p_{i_{n_{k-1}} i_{n_k}}^{(n_k - n_{k-1})} \\
&(一维概率分布公式) \\
&= \sum_{i \in S} p_i(0) p_{i i_{n_1}}^{(n_1)} p_{i_{n_1} i_{n_2}}^{(n_2 - n_1)} \cdots p_{i_{n_{k-1}} i_{n_k}}^{(n_k - n_{k-1})}, \quad i_{n_1}, \cdots, i_{n_k} \in S.
\end{align*}
$$

## 4.5 例题

### 4.5.1 已知条件

状态空间 $S=\{1,2,3\}$

转移矩阵：

$$
P=\begin{bmatrix} \frac{1}{3} & \frac{1}{3} & \frac{1}{3} \\ \frac{1}{2} & 0 & \frac{1}{2} \\ 0 & 1 & 0 \end{bmatrix}
$$

初始分布：

$$
P(0)=(\frac{1}{2},\frac{1}{2},0)
$$

### 4.5.2 求解目标

- 状态概率 $p_2(2)$
- 联合概率 $P(X_1=1,X_2=2,X_4=3)$

### 4.5.3 解答过程

#### 计算状态概率 $p_2(2)$

根据关系式：

$$
p_j(n)=\sum_{i \in S} p_i(0)p_{ij}^{(n)}
$$

我们需要计算$p_2(2)$，即：

$$
p_2(2)=\sum_{i \in S} p_i(0)p_{i2}^{(2)}
$$

首先计算两步转移概率矩阵$P^{(2)}=P^2$：

$$
P^{(2)}=P \cdot P = \begin{bmatrix} \frac{1}{3} & \frac{1}{3} & \frac{1}{3} \\ \frac{1}{2} & 0 & \frac{1}{2} \\ 0 & 1 & 0 \end{bmatrix} \cdot \begin{bmatrix} \frac{1}{3} & \frac{1}{3} & \frac{1}{3} \\ \frac{1}{2} & 0 & \frac{1}{2} \\ 0 & 1 & 0 \end{bmatrix}
$$

计算得到：

$$
P^{(2)} = \begin{bmatrix} \frac{5}{18} & \frac{4}{9} & \frac{5}{18} \\ \frac{1}{6} & \frac{1}{2} & \frac{1}{3} \\ \frac{1}{2} & 0 & \frac{1}{2} \end{bmatrix}
$$

因此：

$$
p_2(2) = p_1(0) \cdot p_{12}^{(2)} + p_2(0) \cdot p_{22}^{(2)} + p_3(0) \cdot p_{32}^{(2)}
$$

代入数值：

$$
p_2(2) = \frac{1}{2} \cdot \frac{4}{9} + \frac{1}{2} \cdot \frac{1}{2} + 0 \cdot 0 = \frac{2}{9} + \frac{1}{4} = \frac{17}{36}
$$

#### 计算联合概率 $P(X_1=1,X_2=2,X_4=3)$

根据联合概率分布公式：

$$
P(X_1=i_1,X_2=i_2,X_4=i_4) = \sum_{i_0 \in S} p_{i_0} \cdot p_{i_0i_1} \cdot p_{i_1i_2} \cdot p_{i_2i_3} \cdot p_{i_3i_4}
$$

由于我们只需要计算特定路径的概率，可以直接计算：

$$
P(X_1=1,X_2=2,X_4=3) = \sum_{i_0 \in S} p_{i_0} \cdot p_{i_01} \cdot p_{12} \cdot p_{23}^{(2)}
$$

首先计算两步转移概率$p_{23}^{(2)}$，从上面的计算可知$p_{23}^{(2)} = \frac{1}{3}$。

因此：

$$
P(X_1=1,X_2=2,X_4=3) = \sum_{i_0 \in S} p_{i_0} \cdot p_{i_01} \cdot p_{12} \cdot p_{23}^{(2)}
$$

代入数值：

$$
P(X_1=1,X_2=2,X_4=3) = \left(\frac{1}{2} \cdot \frac{1}{3} \cdot \frac{1}{3} + \frac{1}{2} \cdot \frac{1}{2} \cdot \frac{1}{3}\right) \cdot \frac{1}{3} = \left(\frac{1}{18} + \frac{1}{12}\right) \cdot \frac{1}{3} = \frac{5}{36} \cdot \frac{1}{3} = \frac{5}{108}
$$

## 4.6 状态的分类及状态空间的分解

### 4.6.1 状态的周期

定义：设$\{X(n),n \geq 0\}$为齐次马氏链，若集合$\{n \| n \geq 1,p_{ii}^{(n)}>0\}$不空（即从状态$i$出发能回到状态$i$），就称该集合的最大公约数$d=d(i)$为状态$i$的周期。

从定义来看，$n$是从状态$i$出发能回到状态$i$的步数，所以从状态$i$出发能回到状态$i$的路径不止>一 条，那么需要的步数$n \geq 1$，所有路径步数的最大公约数就是周期。

如果集合$\{n \| n \geq 1,p_{ii}^{(n)}>0\}$为空，那么从状态$i$出发不能回到状态$i$，则$d=\infty$.

特别地，若$d=1$，则称状态$i$为非周期的。

> [!NOTE]
>
> 也就是说，状态$i$只能在原地转圈。

当$n$不是$d$的整数倍时，$p_{ii}^{(n)}=0$.

> [!NOTE]
>
> 因为步数不为整数，就说明状态不定，没有达到任何状态，所以转移概率为 0.

**命题：**若$i$的周期为$d$，则存在正整数$M$，对一切$k \geq M$，有$p_{ii}^{(n)}>0$.

如果$k$很小，此概率有可能为 0.

### 4.6.2 首中概率

记

$$
f_{ij}^{(n)} = P(X(m+n) = j, X(m+k) \neq j, 1 \leq k \leq n-1 | X(m) = i),\\ f_{ij}^{(0)} = 0,\ \forall\ i,j \in S.
$$

**在齐次马氏链的条件下，可以证明上式与 $ m $ 无关，它表示质点由 $ i $ 出发，恰好经过 $ n $ 步首次到达状态 $ j $ 的概率，称 $ f\_{ij}^{(n)} $ 为首中概率。**

> [!NOTE]
>
> 也就是说，如果在$n$步之前就从状态$i$到达状态$j$，那么$f_{ij}^{(n)}=0$，毕竟第$n$步时已经不是第一次到达状态$j$了。

### 4.6.3 有限步概率

**定义：**$f_{ij}=\sum_{n=1}^{\infty} f_{ij}^{(n)}$.

该定义表示质点从状态$i$出发，经过有限步最终到达状态$j$的概率。

> [!NOTE]
>
> 前面我们在[Chapman-Kolmogorov（C-K）方程](#4.3 Chapman-Kolmogorov（C-K）方程)提到，从状态$i$经过有限步到达$j$的概率为所有路径转移概率的总和。
>
> 此处有限步是指每个$f_{ij}^{(n)}$中的步数$n$是有限的。

例题

设 $\{X(n), n \geq 0\}$ 为齐次马氏链，状态空间$ S = \{1,2,3\} $，一步转移矩阵为

$$
P = \begin{pmatrix}
\frac{1}{6} & \frac{1}{3} & \frac{1}{2} \\
0 & \frac{1}{4} & \frac{3}{4} \\
0 & 1 & 0
\end{pmatrix}
$$

求$ f*{ij}^{(n)} $以及$ f*{ii} $。（画出状态转移图！）

解：

（1）状态$ i=1 $

- $ f_{11}^{(1)} = \frac{1}{6} $，$ f_{11}^{(n)} = 0, \ n \geq 2 \Rightarrow f_{11} = \frac{1}{6} $；
- $ f_{12}^{(1)} = \frac{1}{3} $，$ f_{12}^{(n)} = \frac{1}{3}\left( \frac{1}{6} \right)^{n-1} + \frac{1}{2}\left( \frac{1}{6} \right)^{n-2}, \ n \geq 2 $；
- $ f_{13}^{(1)} = \frac{1}{2} $，$ f_{13}^{(n)} = \frac{1}{2}\left( \frac{1}{6} \right)^{n-1} + \sum_{k=0}^{n-2} \frac{1}{4}\left( \frac{1}{6} \right)^k \left( \frac{1}{4} \right)^{n-k-2}, \ n \geq 2 $。

（2）状态$ i=2 $

- $ f_{21}^{(n)} = 0, \ n \geq 1 $；
- $ f_{22}^{(1)} = \frac{1}{4} $，$ f_{22}^{(2)} = \frac{3}{4} $，$ f_{22}^{(n)} = 0, \ n \geq 3 \Rightarrow f_{22} = 1 $；
- $ f_{23}^{(1)} = \frac{3}{4} $，$ f_{23}^{(n)} = 0, \ n \geq 2 \Rightarrow f_{23} = 1 $。

（3）状态$ i=3 $

- $ f_{31}^{(n)} = 0, \ n \geq 1 $；
- $ f_{32}^{(1)} = 1 $，$ f_{32}^{(n)} = 0, \ n \geq 2 $；
- $ f_{33}^{(1)} = 0 $，$ f_{33}^{(n)} = \frac{3}{4}\left( \frac{1}{4} \right)^{n-2}, \ n \geq 2 \Rightarrow f_{33} = \sum_{n=2}^{\infty} \frac{3}{4}\left( \frac{1}{4} \right)^{n-2} = 1 $。

> [!NOTE]
>
> 首中概率、转移概率的关系
>
> **不同之处：**
>
> - 转移概率$p_{ij}^{(n)}$：质点从状态 i 出发，经过 n 步转移后处于状态 j 的概率（不要求 “首次”，中间可多次经过 j）。
> - 首中概率$f_{ij}^{(n)}$：质点从状态 i 出发，恰好第 n 步首次到达状态 j 的概率（强调 “首次”，前$n-1$步都不在 j）；$f_{ij} = \sum_{n=1}^{\infty} f_{ij}^{(n)}$是 “终于到达 j 的总概率”。
>
> **关系**
>
> $$
> \begin{align}
> p_{ij}^{(n)}&=\sum_{l=1}^{n} f_{ij}^{(l)}p_{jj}^{(n-l)} \\
> \end{align}
> $$

### 4.6.4 状态的分类

#### 常返与非常返

- 常返状态：$f_{ii}=1$
- 非常返状态：$f_{ii}<1$

#### 当状态$i$是常返状态，平均回转时间（步数）

$$
\mu_i = \sum_{m=1}^{\infty} nf_{ii}^{(n)}
$$

这可以看作是从状态$i$出发首次到达状态$i$步数恰好为$n$的期望，所以求出的也是步数。

> [!CAUTION]
>
> 注意与转移概率的不同，并且转移概率可以分解为首中概率和停留概率的相乘结果之和。

那么，

- 正常返状态：$\mu_i < \infty$
- 零常返状态：$\mu_i = \infty$

与周期的关系

当处于正常返状态时，说明从状态$i$回到状态$i$的平均步数为$\mu_i$，所以周期$d$肯定为正整数。

- 当周期$d=1$，那么状态$i$是非周期的。因为周期为 1，相当于将状态遍历了一遍，所以也称为遍历态。
- 当周期$d \geq 2$，那么状态$i$是周期的。

当处于零常返状态时，说明从状态$i$回到状态$i$的平均步数为无限，根本不可能回到原状态，那么周期$d$​ 肯定为非整数的，就没有是不是周期的这一说了。

> [!NOTE]
>
> 从零常返状态也能看出，因为平均步数为无限，还根据转移概率和首中概率的分解关系，因为最后要停留在状态$i$又不可能停留在状态$i$，所以得有无穷个中间状态让质点走下去。

<!--  -->

> [!IMPORTANT]
>
> 所以
>
> - **只有马氏链具有无穷多个状态时，才会出现零常返状态。**
>
> - **有限状态的马氏链要么非常返，要么正常返。**

### 4.6.5 常返性的其他判别

1. 通过返回的次数判断

   $$
   \sum_{n=0}^{\infty} p_{ii}^{(n)} = \frac{1}{1 - f_{ii}}
   $$

   上面在讨论状态的周期时，每一次返回状态$i$都会有一个步数和对应的概率。

   - 当只返回了有限次，那么这些步数之和也为有限的，所以上式为$< \infty$，那么$f_{ii} < 1$，为非常返的。
   - 当返回了无限次，那么这些步数之和也为无限的，所以上式为$= \infty$，那么$f_{ii} = 1$，为常返的。

2. 通过级数判断常返性

   **设 $ i $ 常返**且有周期 $ d $，则

   $$
   \lim_{n \to \infty} p_{ii}^{(nd)} = \frac{d}{\mu_i}
   $$

   其中 $ \mu_i $ 为 $ i $ 的平均返回时间，当 $ \mu_i = \infty $ 时，$ \frac{d}{\mu_i} = 0 $。

推论

设 $ i $ 常返，则

1. $ i $ 零常返 $ \Longleftrightarrow \lim*{n \to \infty} p*{ii}^{(n)} = 0 $；（因为 $ \mu_i = \infty $；非常返结论相同因为级数收敛，通项趋向于 0）
2. $ i $ 遍历 $ \Longleftrightarrow \lim*{n \to \infty} p*{ii}^{(n)} = \frac{1}{\mu_i} $。

## 4.7 可达与互通

- **可达（$ i \to j $）**：如果存在 $ n > 0 $，使 $ p\_{ij}^{(n)} > 0 $，则称自状态 $ i $ 可达状态 $ j $，并记为 $ i \to j $。
- **互通（$ i \longleftrightarrow j $）**：如果 $ i \to j $ 且 $ j \to i $，则称状态 $ i $ 与 $ j $ 互通，并记成 $ i \longleftrightarrow j $。

### 4.7.1 可达与互通的性质

1. “可达”和“互通”均具有传递性。
2. “互通”是等价关系（自反性、对称性、传递性），有如下很好的性质：如 $ i \longleftrightarrow j $，则
   (1) $ i $ 和 $ j $ 同为常返或非常返，如为常返，则它们同为正常返或零常返。
   (2) 同为周期的，且有相同的周期。

例题

![image-20251115201658689](/assets/illustrations/image-20251115201658689.png)

## 4.8 闭集和不可分集

- **闭集**：状态空间$ S $的子集$ C $称为闭集，如对任意$ i \in C $及$ j \notin C $都有$ p\_{ij} = 0 $。
- **不可分集**：$C$是闭集，在此基础上，闭集$C$是状态互通的，那么闭集$C$为不可分集。
- **不可分马氏链（不可约）**：若马氏链$ \{X(n)\} $的所有状态都互通，那么整个马氏链是一个闭集，并且是一个不可分集。

> [!NOTE]
>
> 两个没有交集的不可分集，合起来也是个闭集。

![image-20251115204140529](/assets/illustrations/image-20251115204140529.png)

## 4.9 马氏链状态空间的分解定理

任一马氏链的状态空间 $ S $，可唯一地分解成有限个或可列个互不相交的子集 $ D, C_1, C_2, \cdots $ 之和，使得：

1. 每一 $ C_n $ 是由常返状态组成的不可分闭集，且若 $ i \neq k $ 则 $ C_i $ 中的任一状态不能由 $ C_k $ 中状态到达，$ C_1, C_2, \cdots $ 称为**基本常返闭集**。
2. $ C*n $ 中的状态属同类，或全是正常返或全是零常返，在每种情况下，它们有相同的周期且 $ f*{jk} = 1, \forall j, k \in C_n $。（$ \bigcup C_n = C_H \cup C_Q $，$ C_H $为正常返集，$ C_Q $为零常返集。）
3. $ D $ 由全体非常返态组成，$ C_n $中的状态不能到达$ D $中的状态，反之可以。

### 4.9.1 注

1. $ S = D \cup C_H \cup C_Q $。
2. 有的马氏链可能没有$ D $，也可能没有$ C_H $或者$ C_Q $。

### 4.9.2 推论

1. 有限状态马氏链不可能全是非常返的，没有零常返状态，因此不可约有限马氏链必为正常返的。
2. 如果马氏链有一个零常返状态，则必有无限多个零常返状态。

例题

![image-20251115205158447](/assets/illustrations/image-20251115205158447.png)

## 4.10 遍历定理与平稳分布

### 4.10.1 遍历性理解

在极限状态（长时间尺度）下，马氏链的转移概率趋近于一个常数（平稳），且与初始状态无关。例如，无论初始状态是下雨还是不下雨，最终下雨的概率会趋于一个常数（如$ \frac{1}{2} $）。

#### 遍历定理的数学提法（针对$ n $步转移概率$ p\_{ij}^{(n)} $）

当$ n $很大时，需研究以下三个问题：

1. $ p\_{ij}^{(n)} \stackrel{n \to \infty}{\longrightarrow} $ 极限是否存在
2. 若存在，是否与初始状态$ i $无关
3. 若无关，如何求此极限

数学上，关于这类问题的定理称为**遍历定理**。

### 4.10.2 非常返/零常返状态下转移概率的极限性质

**定理**：若$ j $是非常返或零常返状态，则对一切$ i $有：$ \lim*{n \to \infty} p*{ij}^{(n)} = 0 $。

> [!NOTE]
>
> 在该定理中，这个极限是和$i$无关的。

证明过程

1. **利用转移概率与首中概率的关系放缩**
   由$ p*{ij}^{(n)} = \sum*{k=1}^{n} f*{ij}^{(k)} p*{jj}^{(n-k)} $，将其展开并放缩：

   $$
   p_{ij}^{(n)} \leq \sum_{m=N+1}^{n} f_{ij}^{(m)} + \sum_{m=1}^{N} f_{ij}^{(m)} p_{jj}^{(n-m)}
   $$

   （放缩依据：$ p\_{ij}^{(k)} \leq 1 $）

2. **令$ n \to \infty $分析极限**
   由于$ p\_{jj}^{(n-m)} \to 0 $，因此：

   $$
   \lim_{n \to \infty} p_{ij}^{(n)} \leq \sum_{m=N+1}^{\infty} f_{ij}^{(m)}
   $$

3. **利用级数收敛性收尾**
   因为$ \sum*{m=1}^{\infty} f*{ij}^{(m)} = f*{ij} \leq 1 $且级数收敛，尾项和$ \sum*{m=N+1}^{\infty} f*{ij}^{(m)} \to 0 $（当$ N \to \infty $时）。
   令$ N \to \infty $，即得$ \lim*{n \to \infty} p\_{ij}^{(n)} = 0 $。

> [!NOTE]
>
> 如果$j$是正常返状态，$ \lim*{n \to \infty} p*{ij}^{(n)} = 0 $不一定存在。比如：
>
> ![image-20251115210701347](/assets/illustrations/image-20251115210701347.png)

### 马氏链的遍历性

> [!NOTE]
>
> 目的是和上面的极限性质统一，为了让极限和$i$无关。

遍历性定义

设$\{X(n),n=0,1,\cdots\}$为齐次马氏链，若对一切状态$i$及$j$，存在不依赖于$i$的常数$\nu_j$，使得

$$
\lim_{n \to \infty} p_{ij}^{(n)} = \nu_j
$$

则称此马氏链具有**遍历性**。

遍历性意味着：不论系统从哪个状态出发，当转移步数$n$充分大后，转移到状态$j$的概率趋近于$\nu_j$。因此，当$n$很大时，可将$\nu_j$作为$p_{ij}^{(n)}$的近似值，这是遍历性的简单应用。

对于等式$\lim_{n \to \infty} p_{ij}^{(n)} = \nu_j$：

- 左边$p_{ij}^{(n)}$是条件概率；
- 右边$\nu_j$可理解为长时间下的状态概率$\lim_{m \to \infty} P(X(m) = j)$（即极限分布）。

由此引申出问题：如何求$\nu_j$？

关于正常返状态的极限考虑

当$j$为正常返时，$\lim_{n \to \infty} p_{ij}^{(n)}$不一定存在（即使存在也可能与$i$有关）。因此，需考虑：

- $p_{ij}^{(nd)}$（其中$d \geq 1$为状态$j$的周期）；
- 平均值$\frac{1}{n}\sum_{k=1}^{n} p_{ij}^{(k)}$的极限。

### 4.10.3 正常返状态下的极限定理

当 $j$ 为正常返状态时，需结合周期分析极限行为，定义首中概率的周期分解：
记 $f_{ij}(r) = \sum_{m=0}^{\infty} f_{ij}^{(md+r)}$（$0 \leq r \leq d-1$），表示从 $i$ 出发，首次到达 $j$ 时步数满足 $n \equiv r \pmod{d}$ 的总概率，显然 $\sum_{r=0}^{d-1} f_{ij}(r) = f_{ij}$。

#### 正常返状态的极限性质

若 $j$ 为正常返状态，周期为 $d$，则对任意 $i$ 及 $0 \leq r \leq d-1$，有：

$$
\lim_{n \to \infty} p_{ij}^{(nd+r)} = f_{ij}(r) \cdot \frac{d}{\mu_j}
$$

其中 $\mu_j$ 为 $j$ 的平均返回时间。

##### 证明核心

1. 利用周期特性：当 $n \not\equiv 0 \pmod{d}$ 时，$p_{jj}^{(n)} = 0$，因此 $p_{ij}^{(nd+r)}$ 可分解为仅含周期倍数步数的首中概率与转移概率乘积之和；
2. 固定中间步数 $N$ 放缩，先令 $n \to \infty$ 利用 $\lim_{n \to \infty} p_{jj}^{(nd)} = \frac{d}{\mu_j}$，再令 $N \to \infty$ 使尾项和趋于 0，最终等式成立。

##### 推论（不可约正常返链）

若马氏链不可约、正常返且周期为 $d$，则对任意 $i,j \in S$：

$$
\lim_{n \to \infty} p_{ij}^{(nd)} = \frac{d}{\mu_j}
$$

特别地，当 $d=1$（非周期）时：

$$
\lim_{n \to \infty} p_{ij}^{(n)} = \frac{1}{\mu_j}
$$

即极限与初始状态 $i$ 无关。

### 4.10.4 平均值的极限定理

考虑转移概率的时间平均值 $\frac{1}{n}\sum_{k=1}^{n} p_{ij}^{(k)}$，其物理意义为“单位时间内从 $i$ 到达 $j$ 的平均次数”。

#### 平均值极限

对任意状态 $i,j$，有：

$$
\lim_{n \to \infty} \frac{1}{n}\sum_{k=1}^{n} p_{ij}^{(k)} = \begin{cases}
0 & f_{ij} < 1 \\
\frac{f_{ij}}{\mu_j} & f_{ij} = 1
\end{cases}
$$

##### 证明

1. 若 $j$ 为非常返或零常返，由之前定理知 $p_{ij}^{(n)} \to 0$，平均值自然趋于 0；
2. 若 $j$ 为正常返（周期 $d$），利用引理“周期数列的平均值等于各周期分支极限的平均”，结合定理 13 可得结果。

##### 推论（不可约常返链）

若马氏链不可约、常返（$f_{ij}=1$），则对任意 $i,j$：

$$
\lim_{n \to \infty} \frac{1}{n}\sum_{k=1}^{n} p_{ij}^{(k)} = \frac{1}{\mu_j}
$$

若链同时具有遍历性（$\lim_{n \to \infty} p_{ij}^{(n)} = \nu_j$），则 $\nu_j = \frac{1}{\mu_j}$，即极限分布等于单位时间平均返回次数。

### 4.10.5 平稳分布的定义与性质

#### 平稳分布

设齐次马氏链的转移概率矩阵为 $P=(p_{ij})$，若存在概率分布 $\{\pi_j, j \in S\}$ 满足：

1. 非负性：$\pi_j \geq 0$（$\forall j \in S$）；
2. 归一性：$\sum_{j \in S} \pi_j = 1$；
3. 平稳方程：$\pi_j = \sum_{i \in S} \pi_i p_{ij}$（$\forall j \in S$），矩阵形式为 $\Pi = \Pi P$（$\Pi = (\pi_1, \pi_2, \cdots)$）。

则称 $\{\pi_j\}$ 为该马氏链的**平稳分布**。

> [!NOTE]
> 平稳分布的核心特性：若初始分布 $P(0) = \Pi$，则对任意时刻 $n$，绝对分布 $P(n) = \Pi$，即分布不随时间转移而变化。

#### 平稳分布的存在性

设马氏链的状态空间分解为 $S = Q \cup H$，其中 $Q$ 为非常返/零常返状态集，$H = \bigcup_{\alpha} \tilde{C}_{\alpha}$（$\tilde{C}_{\alpha}$ 为基本正常返闭集），则：

1. 平稳分布不存在 $\iff H = \emptyset$（无正常返状态）；
2. 平稳分布唯一 $\iff H$ 仅含一个基本正常返闭集；
3. 平稳分布有无穷多个 $\iff H$ 含至少两个基本正常返闭集。

#### 平稳分布与平均返回时间的关系

1. 马氏链存在平稳分布 $\iff$ 存在正常返状态，且平稳分布恰为 $\{\frac{1}{\mu_j}, j \in S\}$；
2. 推论：
   - 有限状态不可约非周期马氏链必存在唯一平稳分布；
   - 若 $\{\pi_j\}$ 是不可约非周期马氏链的平稳分布，则 $\lim_{n \to \infty} p_{ij}^{(n)} = \pi_j = \frac{1}{\mu_j}$（遍历性与平稳分布等价）。

### 4.10.6 平稳分布与遍历性例题

#### 例 10（平稳分布与平均返回时间求解）

**已知**：马氏链转移矩阵

$$
P = \begin{pmatrix} 0.7 & 0.1 & 0.2 \\ 0.1 & 0.8 & 0.1 \\ 0.05 & 0.05 & 0.9 \end{pmatrix}
$$

**求解**：平稳分布 $\{\pi_1, \pi_2, \pi_3\}$ 及各状态平均返回时间 $\mu_j$。

##### 解答过程

1. 判定链的性质：有限状态、不可约（任意状态间可互达）、非周期（存在一步自转移概率 $p_{11}=0.7>0$，周期 $d=1$），故存在唯一平稳分布。
2. 列平稳方程：
   $$
   \begin{cases}
   \pi_1 = 0.7\pi_1 + 0.1\pi_2 + 0.05\pi_3 \\
   \pi_2 = 0.1\pi_1 + 0.8\pi_2 + 0.05\pi_3 \\
   \pi_3 = 0.2\pi_1 + 0.1\pi_2 + 0.9\pi_3 \\
   \pi_1 + \pi_2 + \pi_3 = 1
   \end{cases}
   $$
3. 化简求解：
   - 第一个方程：$0.3\pi_1 - 0.1\pi_2 - 0.05\pi_3 = 0$ → $6\pi_1 - 2\pi_2 - \pi_3 = 0$；
   - 第二个方程：$-0.1\pi_1 + 0.2\pi_2 - 0.05\pi_3 = 0$ → $-2\pi_1 + 4\pi_2 - \pi_3 = 0$；
   - 第三个方程：$-0.2\pi_1 - 0.1\pi_2 + 0.1\pi_3 = 0$ → $-2\pi_1 - \pi_2 + \pi_3 = 0$；
   - 联立解得：$\pi_1 = 0.1765$，$\pi_2 = 0.2353$，$\pi_3 = 0.5882$。
4. 计算平均返回时间：
   $$
   \mu_1 = \frac{1}{\pi_1} \approx 5.67, \quad \mu_2 = \frac{1}{\pi_2} \approx 4.25, \quad \mu_3 = \frac{1}{\pi_3} \approx 1.70
   $$

#### 例 11（多基本正常返闭集的平稳分布）

**已知**：马氏链状态空间 $S=\{1,2,\cdots,7\}$，转移矩阵

$$
P = \begin{pmatrix}
0.1 & 0.1 & 0.2 & 0.2 & 0.4 & 0 & 0 \\
0 & 0.5 & 0.5 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 1 & 0 & 0 & 0 \\
0 & 1 & 0 & 0 & 0 & 0 & 0 \\
0 & 0 & 0 & 0 & 0.5 & 0.5 & 0 \\
0 & 0 & 0 & 0 & 0.5 & 0 & 0.5 \\
0 & 0 & 0 & 0 & 0 & 0.5 & 0.5
\end{pmatrix}
$$

**求解**：各不可约闭集的平稳分布。

##### 解答

1. 状态空间分解：
   - 不可约正常返闭集 $C_1=\{2,3,4\}$（状态互通，且无法转出）；
   - 不可约正常返闭集 $C_2=\{5,6,7\}$（状态互通，且无法转出）；
   - 非常返集 $D=\{1\}$（可转移到 $C_1$ 和 $C_2$，但无法返回）。
2. 求 $C_1$ 的平稳分布：
   - $C_1$ 的转移子矩阵：
     $$
     P_{C_1} = \begin{pmatrix} 0.5 & 0.5 & 0 \\ 0 & 0 & 1 \\ 1 & 0 & 0 \end{pmatrix}
     $$
   - 列平稳方程 $\Pi_{C_1} = \Pi_{C_1} P_{C_1}$，结合归一性解得：$\pi_2 = \frac{2}{5}$，$\pi_3 = \frac{1}{5}$，$\pi_4 = \frac{2}{5}$。
3. 求 $C_2$ 的平稳分布：
   - $C_2$ 的转移子矩阵：
     $$
     P_{C_2} = \begin{pmatrix} 0.5 & 0.5 & 0 \\ 0.5 & 0 & 0.5 \\ 0 & 0.5 & 0.5 \end{pmatrix}
     $$
   - 列平稳方程解得：$\pi_5 = \pi_6 = \pi_7 = \frac{1}{3}$。
4. 最终平稳分布：
   $$
   \Pi = \left(0, \frac{2}{5}, \frac{1}{5}, \frac{2}{5}, \frac{1}{3}, \frac{1}{3}, \frac{1}{3}\right)
   $$
   （注：非常返状态 $1$ 的平稳概率为 $0$，因长期来看系统会进入正常返闭集并停留）。
