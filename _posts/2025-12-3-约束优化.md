---
title: 约束优化
date: 2025-12-3 14:00:00 +0800
categories: [数学原理, 最优化方法]
tags: [约束优化, 最优解]
math: true
---

## 符号说明

### 1. 基础变量与点符号

| 符号  | 定义说明                                |
| ----- | --------------------------------------- |
| $x$   | 优化变量，$x \in R^n$（$n$ 为变量维度） |
| $x^{* }$ | 最优解（局部极小点或全局极小点）        |
| $n$   | 优化变量的维度，$x \in R^n$             |
| $d$   | 方向向量，$d \in R^n$（$n$ 为变量维度） |

### 2. 可行域与邻域符号

| 符号             | 定义说明                                                                                    |
| ---------------- | ------------------------------------------------------------------------------------------- |
| $X$              | 可行域，满足所有约束条件的变量集合，$X \subseteq R^n$                                       |
| $N(x^{* }, \delta)$ | $ x^{* } $ 的 $\delta$-邻域，$N( x^{* } , \delta )=\\{ x \mid \|x - x^{* } \|_2 \leq \delta\\} $，$ \delta > 0 $ |

### 3. 约束相关集合符号

| 符号            | 定义说明                                                                                                               |
| --------------- | ---------------------------------------------------------------------------------------------------------------------- |
| $E$（或 $E$）   | 等式约束索引集，$E=\\{1,2,\dots,l\\}$，对应约束 $c_i(x)=0$（$i \in E$）                                                  |
| $I$             | 不等式约束索引集，$I=\\{l+1,\dots,m\\}$，对应约束 $c_i(x) \geq 0$（$i \in I$）                                           |
| $I(x^{* })$        | $x^{* } $ 处的不等式有效约束索引集，$I(x^{* } )=\\{i \mid c_i(x^{* })=0, i \in I\\}$                                                |
| $A(x^{* })$        | $x^{* } $ 处的全体有效约束索引集，$A(x^{* })=E \cup I(x^{* })$                                                                   |
| $FD(x^{* }, X)$    | $x^{* } $ 处的可行方向集，含所有使 $x^{* }+td \in X$（$t \in [0,\delta]$）的非零方向 $d$                                      |
| $LFD(x^{* }, X)$   | $x^{* }$ 处的线性化可行方向集，满足 $d^T \nabla c_j(x^{* })=0$（$i \in E$）且 $d^T \nabla c_j(x^{* }) \geq 0$（$i \in I(x^{* })$） |
| $SFD(x^{* }, X)$   | $x^{* }$ 处的序列可行方向集，为可行序列 $\\{x_k\\}$ 极限方向构成的集合                                                      |
| $D(x)$          | 下降方向集，$D(x)=\\{d \mid d^T \nabla f(x) < 0\\}$                                                                      |
| $F2(\lambda^{* })$ | 线性化零约束方向集，Lagrange 乘子 $\lambda^{* }$ 对应的二阶最优性条件辅助集合                                             |

### 4. 函数符号

| 符号                     | 定义说明                                                                                                           |
| ------------------------ | ------------------------------------------------------------------------------------------------------------------ |
| $f(x)$                   | 目标函数，约束最优化问题的极小化对象                                                                               |
| $c_i(x)$                 | 约束函数，$i=1,2,\dots,m$（含等式约束和不等式约束）                                                                |
| $C(x)$                   | 约束向量，$C(x)=(c_1(x),c_2(x),\dots,c_m(x))^T$（等式约束向量）                                                    |
| $L(x, \lambda)$          | Lagrange 函数，$L(x, \lambda)=f(x)-\sum_{i=1}^m \lambda_i c_i(x)$（或 $L(x, \lambda)=f(x)-\lambda^T C(x)$）        |
| $\nabla f(x)$            | 目标函数 $f(x)$ 的梯度向量                                                                                         |
| $\nabla c_i(x)$          | 约束函数 $c_i(x)$ 的梯度向量                                                                                       |
| $\nabla_x L(x, \lambda)$ | Lagrange 函数关于 $x$ 的梯度向量                                                                                   |
| $Q(x, \mu)$              | 外罚函数法的增广目标函数，含目标函数和约束惩罚项（$\mu > 0$ 为罚参数）                                             |
| $\tilde{Q}(x)$           | 外罚函数的惩罚项和，$\tilde{Q}(x)=\sum_{i \in E} c_i^2(x)$（等式约束）或扩展至不等式约束                           |
| $M(x, \lambda, \sigma)$  | 乘子法的增广 Lagrange 函数，$M(x, \lambda, \sigma)=L(x, \lambda)+\sigma \tilde{P}(x)$                              |
| $P(x, \mu)$              | 内点障碍函数法的增广目标函数，$P(x, \mu)=f(x)+\mu \tilde{P}(x)$（$\mu > 0$ 为障碍参数）                            |
| $\tilde{P}(x)$           | 内点障碍函数的障碍项，常用形式：$\sum_{i \in I}\frac{1}{c_i(x)}$（倒数型）或 $-\sum_{i \in I}\ln c_i(x)$（对数型） |

### 5. 参数与常数符号

| 符号          | 定义说明                                                                  |
| ------------- | ------------------------------------------------------------------------- |
| $\delta$      | 邻域半径或可行方向的步长范围参数，$\delta > 0$                            |
| $\mu$         | 罚参数（外罚函数法）或障碍参数（内点障碍函数法），$\mu > 0$且通常逐步减小 |
| $\sigma$      | 乘子法中的罚因子，$\sigma > 0$                                            |
| $\lambda$     | Lagrange 乘子向量，$\lambda=(\lambda_1,\lambda_2,\dots,\lambda_m)^T$      |
| $\lambda^{* }$   | 最优 Lagrange 乘子向量                                                    |
| $\varepsilon$ | 算法迭代的允许误差，$\varepsilon > 0$（控制收敛准则）                     |
| $\beta$       | 乘子法中罚因子的放大系数，$\beta > 1$                                     |
| $k$           | 迭代次数索引（$k=0,1,2,\dots$）                                           |
| $\|·\|_2$     | 向量的 2-范数（欧几里得范数）                                             |
| $d^T$         | 向量 $d$ 的转置                                                           |

## 1. 约束最优化问题的最优性条件

### 1.1 核心定义

#### 严格全局极小点

若$x^{* } \in X$满足$f(x^{* }) < f(x), \forall x \in X, x \neq x^{* }$，则$x^{* }$为严格全局极小点。

#### 严格局部极小点

设$x^{* } \in X$，若存在$\delta > 0$，使得对邻域$N(x^{* }, \delta)$，有$f(x^{* }) < f(x), \forall x \in N(x^{* }, \delta), x \neq x^{* }$，则$x^{* }$为严格局部极小点。

#### 有效约束与无效约束

1. 有效约束和无效约束是对于最优解$x^{* }$来说的。
2. 当最优解$x^{* }$能落在给定约束的边界上，那么这个约束就是有效约束；若是最优解$x^{* }$不能落在这个约束的边界上，只能落在边界内，就是无效约束。
3. 等式约束永远是有效约束。
4. 无效约束可去除而不影响$x^{* }$的局部极小点性质。

#### 线性化可行方向集

$LFD(x^{* }, X)$：$0 \neq d \in R^n$，满足$d^T \nabla c_i(x^{* }) = 0, i \in D$且$d^T \nabla c_i(x^{* }) \geq 0, i \in I(x^{* })$。

条件推导：

前提：$x^{* } \in X$，约束函数$c_i(x) \in E$且可微，$d \in R^n$ 是 $x^{* }$ 处的**可行方向**，$x = x^{* } +td$是在邻域半径内的下一个可行点，属于可能迭代到的点。

对约束函数进行泰勒展开：

$$
\begin{align}
c_i(x^{* } + td) &= c_i(x^{* }) + t \cdot d^T \nabla c_i(x^{* }) + o(t) \\
c_i(x^{* })&=0 \\
c_i(x^{* }+td)&=0
\end{align}
$$

所以

$$
t \cdot d^T \nabla c_i(x^{* })=0
$$

#### 序列可行方向集

$SFD(x^{* }, X)$：$0 \neq d \in R^n$，存在序列$\\{d_k\\}$和$\\{\delta_k\\}$（$k=1,2,3,...$）使得

$$
x=x^{* }+\delta_k d_k \in X
$$

可以获得

$$
\begin{align}
d_k &= \frac{x-x^{* }}{\| x-x^{* } \|} \\
\delta_k &=\| x-x^{* } \|
\end{align}
$$

![image-20251204160541528](/assets/illustrations/image-20251204160541528.png)

从图可以看出：

1. 序列可行方向集只要求步长和方向是序列化的，没有更多的约束，所以是一个扇形的区域。
2. 线性可行方向集规定了当取到最优解时，此时约束函数的导数为 0，那么就也规定了方向$d$的取值范围应该时一组和每个约束函数梯度垂直的序列。
3. 当序列可行方向集和线性可行方向集相同的时候，序列可行方向集就约束为了线性可行方向集，所以序列可行方向集包含线性可行方向集。

#### 下降方向集

$D(x)$：$D(x)=\\{d \mid d^T \nabla f(x) < 0\\}$，方向$d$能使目标函数值减小。

**方向集包含关系**：若所有约束函数在$x^{* } \in X$处可微，则$FD(x^{* }, X) \subseteq SFD(x^{* }, X) \subseteq LFD(x^{* }, X)$。

### 1.2 关键引理

1. **引理 7.1.7**：若$x^{* } \in X$是局部极小点，且$f(x)$和$c_i(x)$在$x^{* }$处可微，则$d^T \nabla f(x^{* }) \geq 0, \forall d \in SFD(x^{* }, X)$，即$SFD(x^{* }, X) \cap D(x) = \emptyset$，局部极小点处无序列可行下降方向。
2. **引理 7.1.8**：若$x^{* } \in X$是局部极小点，且$f(x)$和$c_i(x)$在$x^{* }$处可微，则局部极小点处无可行下降方向，该引理与 7.1.7 本质一致，从不同角度印证极小点的方向特性。

### 1.3 核心定理

#### Farkas 引理

极小化问题的表达式为：

$$
\begin{align}
\min_{x \in \mathbb{R}^n} \quad & f(x) \\
\text{s.t.} \quad & c_i(x) = 0, \quad i \in E \\
& c_i(x) \geq 0, \quad i \in I
\end{align}
$$

其中$c_i(x)=a_i^T x$。

当该问题处于下降状态时，应该符合下面的方程组**有解**；当迭代到最优解$x^{* }$时，应该符合下面的方程组**无解**：

$$
d^T g < 0 \\
d^T a_i =0 , \quad i \in E \\
d^T a_i \geq 0 ,\quad i \in I
$$

那么我们认为

$$
g=\sum_{i \in E} \lambda_i a_i +\sum_{i \in I} \lambda_i a_i
$$

几何说明：

![image-20251204153655689](/assets/illustrations/image-20251204153655689.png)

#### Kuhn-Tucker（KKT）

##### KKT 条件

存在 Lagrange 乘子向量$\lambda^{* }$，满足

1. 驻点条件

   $$
   \nabla f(x^{* }) = \sum_{i=1}^{m} \lambda_i^{* } \nabla c_i(x^{* })
   $$

2. 可行性条件（可行域需要满足的条件）

   $$
   c_i(x^{* })=0 ,i\in E \\
   c_i(x^{* }) \geq 0, i \in I
   $$

3. 乘子非负条件
   $$
   \lambda_i^{* }  \geq 0,i \in I
   $$
4. 互补松弛条件
   $$
   \lambda_i^{* } c_i(x^{* }) = 0,i \in I(x^{* }) \\
   \lambda_i^{* } =0 ,i \in I/I(x^{* })
   $$

满足该条件的点称为 KT 点，$(\lambda^{* }, x^{* })$称为 KT 对。

##### 一阶必要条件（KKT 条件成立则该条件成立）

1. $x^{* }$是**局部**极小点
2. $f(x)$和$c_i(x)$在$x^{* }$邻域内一阶连续可微
3. 约束规范条件$CQ(SFD(x^{* }, X)=LFD(x^{* }, X))$成立。

常用约束规范：线性函数约束规范（LFCQ）、线性无关约束规范（LICQ），两者均能推出$CQ$成立。

![image-20251204164619447](/assets/illustrations/image-20251204164619447.png)

##### 一阶充分条件（能推 KKT 条件）

若$f(x)$和$c_i(x)$在$x^{* }$处可微，且$d^T \nabla f(x^{* }) > 0, \forall 0 \neq d \in SFD(x^{* }, X)$，则$x^{* }$是严格局部极小点。

##### 二阶最优性条件

- 必要性条件：$x^{* }$是局部极小点，线性无关约束规范成立，则 Lagrange 函数在$x^{* }$处的 Hessian 矩阵满足相应正半定性质。
- 充分性条件：$x^{* }$是 KKT 点，其对应的 Lagrange 乘子满足 Hessian 矩阵在特定方向集上正定，则$x^{* }$是严格局部极小点。

##### 凸规划充分条件

凸规划中$f(x)$为凸函数，$c_i(x)(i \in I)$为凹函数，若$x^{* }$是 KKT 点，则$x^{* }$是全局最优解。

## 2. 二次罚函数法与乘子法

### 2.1 外罚函数法（SUMT 外点法）

1. **核心思想**：将约束转化为目标函数的惩罚项，构造增广目标函数，通过求解一系列无约束问题逼近原约束问题的最优解，迭代点从可行域外部逐步趋近最优解。
一句话概括，即违反约束（可行域在约束范围之外）时，目标函数值显著增大。其特征是$x$在可行域$D$外运动，最后约束到边界上。

2. **增广目标函数构造**
    - 等式约束问题：$Q(x, \mu)=f(x)+\frac{1}{2\mu}\sum_{i \in E}c_i^2(x)$，$\mu > 0$为罚参数。
    - 不等式约束问题：构造类似惩罚项，使违反约束时函数值显著增大。
    - 一般约束问题：综合等式与不等式约束的惩罚项，转化为无约束问题$\min Q(x, \mu)(\mu \to 0)$。
3. **算法步骤（算法 7.2.2）**
    1. 给定初始罚参数$\mu_0 > 0$、允许误差$\varepsilon > 0$、初始点$x_0$，令$k = 0$。
    2. 从$x_k$出发，极小化$Q(x, \mu_k)$得近似极小点$x_{k+1}$。
    3. 若$\|\nabla Q(x_{k+1}, \mu_k)\| \leq \varepsilon$，停止迭代；否则更新罚参数$\mu_{k+1} < \mu_k$，令$x_k = x_{k+1}$，$k = k + 1$，返回步骤 2。
    4. **收敛性**：若每个迭代点是罚函数的精确总体极小点，且$\mu_k \to 0$，则序列$\\{x_k\\}$的每个极限点都是原问题的最优解，但无法保证对所有多最优解问题都收敛。
       当使用外罚函数法计算得到的最优解不能收敛，则要采用重新开始的 PRP 算法求解无约束问题。
4. **优缺点**
    - 优点：简单易懂，初始点无需满足可行性。
    - 缺点：近似解无法保证可行；Hessian 矩阵随$\mu$变化趋于病态。

### 2.2 乘子法

1. **核心改进**：结合 Lagrange 函数与罚函数，构造增广 Lagrange 函数，解决外罚函数法中罚参数需趋于 0 的问题，通过迭代修正乘子向量逼近最优解。

2. **增广 Lagrange 函数**：
    对于等式约束问题
    $$
          \begin{align}
          &\min \quad f(x)\\
          &s.t. \quad C(x)=0
          \end{align}
          $$
    构造
    $$
          M(x, \lambda, \sigma)=L(x, \lambda)+\sigma \tilde{P}(x)
          $$
    其中
    $$
          \begin{align}
          L(x, \lambda)&=f(x)-\lambda^T C(x) \\
          \tilde{P}(x)&=\frac{C(x)^TC(x)}{2}
          \end{align}
          $$
    为 Lagrange 函数。

3. **等式约束乘子法（PH 算法）**

    1. 选定初始点$x_1$、初始乘子向量$\lambda_1$、初始罚因子$\sigma_1$、放大系数$\beta > 1$、控制误差$\varepsilon \in (0,1)$，令$k = 1$。
    2. 以$x_{k-1}$为初始点，求解无约束问题$\min M(x, \lambda_k, \sigma_k)$，得最优解$x_{k}$。
    3. 若$\|C(x_{k})\| < \varepsilon$，停止迭代，$x_{k}$为最优解；否则，若$\sigma_k$不足，即$\frac{\|C(x_{k})\|}{\|C(x_{k-1})\|}>\varepsilon$则更新$\sigma_{k+1} = \beta \sigma_k$。
    4. 按公式$\lambda_{k+1} = \lambda_k - \sigma_k C(x_{k})$修正乘子，令$k = k + 1$，返回步骤 2。

4. **关键性质**：存在$\sigma^{* } > 0$，当$\sigma > \sigma^{* }$时，原问题最优解是增广 Lagrange 函数的严格局部极小点。

## 3. 内点障碍函数法

### 3.1 核心原理

内点障碍函数法仅适用于不等式约束问题，通过在可行域内部构造障碍函数，使迭代点始终保持在可行域内部，随着障碍参数$\mu$减小，迭代点逐步逼近约束边界上的最优解。
与外罚函数法同理，内点障碍函数法也称“内罚函数法”，即当$x$从内点接近可行域$D$的边界时，$c_i(x) \rightarrow 0$，那么$\tilde{P}(x) \rightarrow \infty$，最终会迫使$x$落在约束内部。其中特征为，$x$一直在可行域$D$内部移动，最终约束到边界上。

### 3.2 障碍函数构造

增广目标函数为$P(x, \mu)=f(x)+\mu \tilde{P}(x)$，常用的$\tilde{P}(x)$有两种形式：倒数障碍函数$\tilde{P}(x)=\sum_{i \in I}\frac{1}{c_i(x)}$和对数障碍函数$\tilde{P}(x)=-\sum_{i \in I}\ln c_i(x)$。

### 3.3 算法步骤（算法 7.3.2）

1. 给定初始障碍参数$\mu_0 > 0$、允许误差$\varepsilon > 0$、可行域内初始点$x_0$，令$k = 0$。
2. 从$x_k$出发，求解无约束问题$\min P(x, \mu_k)$，得近似最优解$x_{k+1}$。
3. 若满足收敛准则，停止迭代，$x_{k+1}$为近似最优解。
4. 否则，更新障碍参数$\mu_{k+1} < \mu_k$，令$x_k = x_{k+1}$，$k = k + 1$，返回步骤 2。

### 3.4 收敛性与注意事项

收敛性可参考定理 7.3.3，迭代过程中需限制一维搜索的初始区间，确保迭代点始终在可行域内，避免函数值趋于负无穷。算例中常用重新开始的 PRP 算法求解无约束问题。

### 3.5 优缺点

1. 优点：原理简单，迭代点始终严格可行。
2. 缺点：仅处理不等式约束，要求初始点为可行域内点；Hessian 矩阵随$\mu$减小趋于病态。
